{% extends 'blog/base.html' %}
{% load crispy_forms_tags %}
{% block title %}{{ post.title }}{% endblock title %}
{% block content %}
    <h1>{{ post.title }}</h1>
    <p><small>Published {{ post.publish }} by {{ post.author }}</small></p>
    <p class="tags">
        Tags:
        {% for tag in post.tags.all %}
            <a class="badge badge-success" href="{% url 'post_list_by_tag' tag.slug %}">{{ tag.name }}</a>
            <!-- {% if not forloop.last %}, {% endif %} -->
        {% endfor %}
    </p>
    {% if is_liked %}
        <p>{{ post.likes.count }} <a href="{{ post.get_like_url }}">Like</a></p>
    {% else %}
        <p>{{ post.likes.count }} <a href="{{ post.get_like_url }}">Dislike</a></p>
    {% endif %}

    <p>{{ post.body|linebreaks }}</p>

    <div class="media bg-light mb-5">
        <img class="rounded-circle profile-image mr-3 mt-2 ml-3" src="{{ post.author.profile.image.url }}" alt="">
        <div class="media-body mt-2">
            <h5>{{ post.author }}</h5>
            <p>!!!Author Description!!!
                Lorem ipsum dolor sit amet, consectetur adipisicing elit. Beatae,
                reiciendis dolor error tenetur odio assumenda, facere consequatur
                ad quis numquam. Vitae temporibus rerum aliquid, quasi cupiditate
                qui id perferendis libero.
            </p>
        </div>
    </div>

    <h2>Similar posts</h2>
    <div class="row mb-5">
        {% for post in similar_posts %}
            <div class="col-lg-3">
                <div class="card h-100 items-align-center">
                    <div class="card-body">
                        <a class="card-title" href="{{ post.get_absolute_url }}">{{ post.title }}</a>
                    </div>
                </div>
            </div>
            <!-- <div class="col-lg-3">
                <a href="{{ post.get_absolute_url }}">{{ post.title }}</a>
            </div> -->
        {% empty %}
            There are no similar posts yet.
        {% endfor %}
    </div>

    {% with comments.count as total_comments %}
        <h2>{{ total_comments }} comment{{ total_comments|pluralize }}</h2>
    {% endwith %}
    <div class="row mt-4">
        <div class="col-lg-8">
            {% for comment in comments %}
                    <div class="media comment-section mb-3 bg-light pr-2">
                        <img class="rounded-circle comment-author-img ml-3 mt-2 mr-3"
                            src="{{ comment.user.profile.image.url }}">
                        <div class="media-body">
                            <div class="comment-metadata">
                                <p class="comment_username mt-2 border-bottom">
                                    {{ comment.user }}
                                    <small class="comment_timestamp text-muted ml-2">
                                        {{ comment.created|date:"F d, Y" }}
                                    </small>
                                </p>
                            </div>
                            <p class="comment_body">{{ comment.body }}</p>
                        </div>
                    </div>
            {% empty %}
                <p>There are no comments yet.</p>
            {% endfor %}
        </div>
    </div>
    {% if new_comment %}
        <h3>Your comment has been added.</h3>
    {% else %}
        <h2 class="mt-5">Add new comment</h2>
        <form action="." method="post" class="mb-5">
            {{ comment_form|crispy }}
            {% csrf_token %}
            <button class="btn btn-info" type="submit" value="Add comment">new comment</button>
        </form>
    {% endif %}
{% endblock content %}
